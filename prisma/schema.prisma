generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Categoria {
  id        String    @id @default(uuid())
  nome      String    @unique
  descricao String?
  ativo     Boolean   @default(true)
  ordem     Int       @default(0)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  produtos  Produto[]

  @@map("categorias")
}

model Bairro {
  id         String   @id @default(cuid())
  nome       String
  cidade     String
  estado     String
  valorFrete Decimal  @db.Decimal(10, 2)
  ativo      Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([nome, cidade])
  @@index([cidade])
  @@index([ativo])
}

model Produto {
  id          String          @id @default(uuid())
  nome        String
  descricao   String?
  preco       Decimal         @db.Decimal(10, 2)
  imagemUrl   String?
  ativo       Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  categoriaId String?
  itensPedido ItemPedido[]
  imagens     ProdutoImagem[]
  categoria   Categoria?      @relation(fields: [categoriaId], references: [id])

  @@map("produtos")
}

model ProdutoImagem {
  id        String   @id @default(uuid())
  produtoId String
  url       String
  ordem     Int      @default(0)
  principal Boolean  @default(false)
  createdAt DateTime @default(now())
  produto   Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("produto_imagens")
}

model Cliente {
  id             String            @id @default(cuid())
  nome           String
  email          String            @unique
  telefone       String
  senha          String?
  cpf            String?           @unique
  dataNascimento DateTime?
  role           String            @default("cliente")
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  enderecos      EnderecoCliente[]
  pedidos        Pedido[]

  @@index([role])
  @@map("clientes")
}

model EnderecoCliente {
  id          String   @id @default(uuid())
  clienteId   String
  apelido     String
  cep         String
  endereco    String
  numero      String
  complemento String?
  bairro      String
  cidade      String
  estado      String
  referencia  String?
  principal   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cliente     Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@map("enderecos_cliente")
}

model Pedido {
  id                   String       @id @default(cuid())
  compradorNome        String
  compradorEmail       String?
  compradorTelefone    String
  destinatarioNome     String
  destinatarioTelefone String
  dataEntrega          DateTime
  periodoEntrega       String
  tipoEndereco         String
  cep                  String
  endereco             String
  numero               String
  complemento          String?
  bairro               String
  cidade               String
  estado               String
  referencia           String?
  mensagem             String?
  valorTotal           Decimal      @db.Decimal(10, 2)
  status               String       @default("PENDENTE")
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  clienteId            String?
  statusPagamento      String       @default("AGUARDANDO_PIX")
  dataConfirmacao      DateTime?
  valorFrete           Decimal      @default(0) @db.Decimal(10, 2)
  valorProdutos        Decimal      @default(0) @db.Decimal(10, 2)
  metodoPagamento      String?      @default("PIX")
  comprovantePagamento String?
  dataPagamento        DateTime?
  pixCopiaCola         String?
  itens                ItemPedido[]
  cliente              Cliente?     @relation(fields: [clienteId], references: [id])

  @@index([clienteId])
  @@index([status])
  @@index([statusPagamento])
  @@index([createdAt])
  @@map("pedidos")
}

model ItemPedido {
  id         String   @id @default(uuid())
  pedidoId   String
  produtoId  String
  quantidade Int
  precoUnit  Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  pedido     Pedido   @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto    Produto  @relation(fields: [produtoId], references: [id])

  @@index([pedidoId])
  @@index([produtoId])
  @@map("itens_pedido")
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([role])
  @@index([email])
}
