generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Produto {
  id          String          @id @default(uuid())
  nome        String
  descricao   String?
  categoria   String
  preco       Decimal         @db.Decimal(10, 2)
  imagemUrl   String?
  ativo       Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  itensPedido ItemPedido[]
  imagens     ProdutoImagem[]

  @@map("produtos")
}

model ProdutoImagem {
  id        String   @id @default(uuid())
  produtoId String
  url       String
  ordem     Int      @default(0)
  principal Boolean  @default(false)
  createdAt DateTime @default(now())
  produto   Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("produto_imagens")
}

model Cliente {
  id             String            @id @default(cuid())
  nome           String
  email          String            @unique
  telefone       String
  senha          String?
  cpf            String?           @unique
  dataNascimento DateTime?
  role           String            @default("cliente")
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  enderecos      EnderecoCliente[]
  pedidos        Pedido[]

  @@index([role], map: "idx_clientes_role")
  @@map("clientes")
}

model EnderecoCliente {
  id          String   @id @default(uuid())
  clienteId   String
  apelido     String
  cep         String
  endereco    String
  numero      String
  complemento String?
  bairro      String
  cidade      String
  estado      String
  referencia  String?
  principal   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cliente     Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@map("enderecos_cliente")
}

model Pedido {
  id                   String       @id @default(uuid())
  compradorNome        String
  compradorEmail       String
  compradorTelefone    String
  destinatarioNome     String
  destinatarioTelefone String
  dataEntrega          DateTime
  periodoEntrega       String
  tipoEndereco         String
  cep                  String
  endereco             String
  numero               String
  complemento          String?
  bairro               String
  cidade               String
  estado               String
  referencia           String?
  mensagem             String?
  valorTotal           Decimal      @db.Decimal(10, 2)
  status               String       @default("PENDENTE")
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  clienteId            String?
  formaPagamento       String?
  statusPagamento      String       @default("PENDENTE")
  itens                ItemPedido[]
  cliente              Cliente?     @relation(fields: [clienteId], references: [id])

  @@index([clienteId])
  @@index([compradorEmail])
  @@index([status])
  @@map("pedidos")
}

model ItemPedido {
  id         String   @id @default(uuid())
  pedidoId   String
  produtoId  String
  quantidade Int
  precoUnit  Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  pedido     Pedido   @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto    Produto  @relation(fields: [produtoId], references: [id])

  @@map("itens_pedido")
}
